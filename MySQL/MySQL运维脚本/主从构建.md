实例的主从复制构建：


1.xtrabackup
```
备份-恢复数据到新实例之后，检查checkpoint文件，找到位点，在新实例构建主从联系change master。
```


2.mysqldump

> 主要4个步骤

```
1.备份实例数据并记录下当前数据位点
mysqldump -uroot -p'' -hxxxx --single-transaction --master-data=2 > ins.sql 

# --single-transaction 原理↓
    # SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;  # 事务可重复读
    # START TRANSACTION WITH CONSISTENT SNAPSHOT;               # 实例的一致性镜像(MVCC)

# --master-data : 记录当前实例binlog位点
```

```
2.导入新实例
mysql -uroot -p'' -hxxxx < ins.sql
```


```
3.主库创建复制用户
CREATE USER 'repl_user'@'%' IDENTIFIED BY 'your_password';
GRANT REPLICATION SLAVE ON *.* TO 'repl_user'@'%';

4.登录从库构建主从链接,位点来自于备份文件末尾。
CHANGE MASTER TO
       MASTER_HOST='master_ip',
       MASTER_USER='repl_user',
       MASTER_PASSWORD='your_password',
       MASTER_PORT=3306,
       MASTER_AUTO_POSITION=1;

```
```
如果是GTID模式创建主从，在从库操作必要时：
reset slave  ：重置作为从库的历史链接信息。
reset master : 重置当前库的二进制日志，gtid_executed，gtid_purged。
SET @@GLOBAL.gtid_purged = "2174B383-5441-11E8-B90A-C80AA9429562:1-1029, 224DA167-0C0C-11E8-8442-00059A3C7B00:1-2695";
最后再进行change master
```
